<!DOCTYPE html>
<html lang="es">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årbol de Amor Animado</title>
    <!-- Autor√≠a y derechos -->
    <meta name="author" content="Zero">
    <meta name="copyright" content="Zero - C√≥digo libre no comercial">
    <meta name="description" content="√Årbol de Amor Animado: una sorpresa interactiva y rom√°ntica para dedicar a tu pareja o ser querido. C√≥digo libre para uso personal, educativo o de inspiraci√≥n.">
    <meta name="keywords" content="amor, sorpresa, rom√°ntico, dedicatoria, animaci√≥n, √°rbol, corazones, pareja, aniversario, regalo digital">
    <meta name="robots" content="index, follow">
    <!-- Estilos -->
    <link rel="stylesheet" href="Css/style.css">
    <link rel="stylesheet" href="Css/style.mobile.css" media="only screen and (max-width: 600px)">
    <style>
      /* Estilos CSS incluidos en tu c√≥digo original */
      .tree-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        height: 400px;
        z-index: 2;
      }
      .animated-heart {
        transform-origin: center;
        animation: beat 1s infinite;
      }
      @keyframes beat {
        0%, 100% { transform: scale(1); }
        20% { transform: scale(1.1); }
        40% { transform: scale(0.95); }
        60% { transform: scale(1.08); }
        80% { transform: scale(1); }
      }
      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background: #fcfcfc;
      }

      #fireworks-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: block;
        z-index: 1;
        pointer-events: none;
      }

      #center-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 5rem;
        color: #e60026;
        font-family: 'Arial Black', Arial, sans-serif;
        text-shadow: 2px 2px 8px #ffb3b3;
        z-index: 2;
        letter-spacing: 0.5rem;
        user-select: none;
        display: flex;
        gap: 0.5rem;
        pointer-events: none;
      }

      .letter {
        opacity: 0;
        transition: opacity 0.5s;
      }

      /* Otros estilos ... */

    </style>
</head>
<body>
    <div id="floating-objects"></div>
    <div class="dedication-text" id="dedication-text">
      <div class="signature" id="signature"></div>
    </div>
    <div class="countdown" id="countdown"></div>
    <div class="tree-container" id="tree-container"></div>
    <audio
  id="bg-music"
  preload="auto"
  loop
  playsinline
>
  <source src="Music/fondo.mp3" type="audio/mpeg">
</audio>

<audio
  id="btn-music"
  preload="auto"
  playsinline
>
  <source src="Music/boton.mp3" type="audio/mpeg">
</audio>

    
    <!-- Aqu√≠ va el script JS con la funcionalidad a√±adida -->
    <script>
      // √Ç¬© Zero - C√≥digo libre no comercial

      // Cargar el SVG y animar los corazones
      fetch('Img/treelove.svg')
        .then(res => res.text())
        .then(svgText => {
          const container = document.getElementById('tree-container');
          container.innerHTML = svgText;
          const svg = container.querySelector('svg');
          if (!svg) return;

          // Animaci√≥n de "dibujo" para todos los paths
          const allPaths = Array.from(svg.querySelectorAll('path'));
          allPaths.forEach(path => {
            path.style.stroke = '#222';
            path.style.strokeWidth = '2.5';
            path.style.fillOpacity = '0';
            const length = path.getTotalLength();
            path.style.strokeDasharray = length;
            path.style.strokeDashoffset = length;
            path.style.transition = 'none';
          });

          // Forzar reflow y luego animar
          setTimeout(() => {
            allPaths.forEach((path, i) => {
              path.style.transition = `stroke-dashoffset 1.2s cubic-bezier(.77,0,.18,1) ${i * 0.08}s, fill-opacity 0.5s ${0.9 + i * 0.08}s`;
              path.style.strokeDashoffset = 0;
              setTimeout(() => {
                path.style.fillOpacity = '1';
                path.style.stroke = '';
                path.style.strokeWidth = '';
              }, 1200 + i * 80);
            });

            // Despu√©s de la animaci√≥n de dibujo, mueve y agranda el SVG
            const totalDuration = 1200 + (allPaths.length - 1) * 80 + 500;
            setTimeout(() => {
              svg.classList.add('move-and-scale');
              // Mostrar texto con efecto typing
              setTimeout(() => {
                showDedicationText();
                // Mostrar p√©talos flotando
                startFloatingObjects();
                // Mostrar cuenta regresiva
                showCountdown();
                // Iniciar m√∫sica de fondo
                playBackgroundMusic();
              }, 1200); // Tiempo para agrandar el SVG
            }, totalDuration);
          }, 50);

          // Selecciona los corazones (formas rojas)
          const heartPaths = allPaths.filter(el => {
            const style = el.getAttribute('style') || '';
            return style.includes('#FC6F58') || style.includes('#C1321F');
          });
          heartPaths.forEach(path => {
            path.classList.add('animated-heart');
          });
        });

      // Funciones auxiliares (dedicatoria, firma, objetos flotantes, etc.)
      function getURLParam(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
      }

      function showDedicationText() {
        let text = getURLParam('text');
        if (!text) {
          text = `Para el amor de mi vida:\n\nDesde el primer momento supe que eras t√∫...`;  // Texto de ejemplo
        } else {
          text = decodeURIComponent(text).replace(/\\n/g, '\n');
        }
        const container = document.getElementById('dedication-text');
        container.classList.add('typing');
        let i = 0;
        function type() {
          if (i <= text.length) {
            container.textContent = text.slice(0, i);
            i++;
            setTimeout(type, text[i - 2] === '\n' ? 350 : 45);
          } else {
            setTimeout(showSignature, 600);
          }
        }
        type();
      }

      function showSignature() {
        const dedication = document.getElementById('dedication-text');
        let signature = dedication.querySelector('#signature');
        if (!signature) {
          signature = document.createElement('div');
          signature.id = 'signature';
          signature.className = 'signature';
          dedication.appendChild(signature);
        }
        let firma = getURLParam('firma');
        signature.textContent = firma ? decodeURIComponent(firma) : "Con amor, Zero";
        signature.classList.add('visible');
      }

      function startFloatingObjects() {
        const container = document.getElementById('floating-objects');
        let count = 0;
        function spawn() {
          let el = document.createElement('div');
          el.className = 'floating-petal';
          el.style.left = `${Math.random() * 90 + 2}%`;
          el.style.top = `${100 + Math.random() * 10}%`;
          el.style.opacity = 0.7 + Math.random() * 0.3;
          container.appendChild(el);

          const duration = 6000 + Math.random() * 4000;
          const drift = (Math.random() - 0.5) * 60;
          setTimeout(() => {
            el.style.transition = `transform ${duration}ms linear, opacity 1.2s`;
            el.style.transform = `translate(${drift}px, -110vh) scale(${0.8 + Math.random() * 0.6}) rotate(${Math.random() * 360}deg)`;
            el.style.opacity = 0.2;
          }, 30);

          setTimeout(() => {
            if (el.parentNode) el.parentNode.removeChild(el);
          }, duration + 2000);

          if (count++ < 32) setTimeout(spawn, 350 + Math.random() * 500);
          else setTimeout(spawn, 1200 + Math.random() * 1200);
        }
        spawn();
      }

      function showCountdown() {
        const container = document.getElementById('countdown');
        let startParam = getURLParam('start');
        let eventParam = getURLParam('event');
        let startDate = startParam ? new Date(startParam + 'T00:00:00') : new Date('2024-08-03T00:00:00');
        let eventDate = eventParam ? new Date(eventParam + 'T00:00:00') : new Date('2025-08-03T00:00:00');

        function update() {
          const now = new Date();
          let diff = now - startDate;
          let days = Math.floor(diff / (1000 * 60 * 60 * 24));
          let eventDiff = eventDate - now;
          let eventDays = Math.max(0, Math.floor(eventDiff / (1000 * 60 * 60 * 24)));
          let eventHours = Math.max(0, Math.floor((eventDiff / (1000 * 60 * 60)) % 24));
          let eventMinutes = Math.max(0, Math.floor((eventDiff / (1000 * 60)) % 60));
          let eventSeconds = Math.max(0, Math.floor((eventDiff / 1000) % 60));

          container.innerHTML =
            `Llevamos juntos: <b>${days}</b> d√≠as<br>` +
            `Nuestro aniversario: <b>${eventDays}d ${eventHours}h ${eventMinutes}m ${eventSeconds}s</b>`;
          container.classList.add('visible');
        }
        update();
        setInterval(update, 1000);
      }

      // --- M√∫sica de fondo ---
      function playBackgroundMusic() {
        const audio = document.getElementById('bg-music');
        if (!audio) return;

        // --- Opci√≥n archivo local por par√°metro 'musica' ---
        let musicaParam = getURLParam('musica');
        if (musicaParam) {
          musicaParam = decodeURIComponent(musicaParam).replace(/[^\w\d .\-]/g, '');
          audio.src = 'Music/' + musicaParam;
        }

        // --- Opci√≥n YouTube (solo mensaje de ayuda) ---
        let youtubeParam = getURLParam('youtube');
        if (youtubeParam) {
          let helpMsg = document.getElementById('yt-help-msg');
          if (!helpMsg) {
            helpMsg = document.createElement('div');
            helpMsg.id = 'yt-help-msg';
            helpMsg.style.position = 'fixed';
            helpMsg.style.right = '18px';
            helpMsg.style.bottom = '180px';
            helpMsg.style.background = 'rgba(255,255,255,0.95)';
            helpMsg.style.color = '#e60026';
            helpMsg.style.padding = '10px 16px';
            helpMsg.style.borderRadius = '12px';
            helpMsg.style.boxShadow = '0 2px 8px #e6002633';
            helpMsg.style.fontSize = '1.05em';
            helpMsg.style.zIndex = 100;
            helpMsg.innerHTML = 'Para usar m√∫sica de YouTube, descarga el audio (por ejemplo, usando y2mate, 4K Video Downloader, etc.), col√≥calo en la carpeta <b>Music</b> y usa la URL as√≠:<br><br><code>?musica=nombre.mp3</code>';
            document.body.appendChild(helpMsg);
            setTimeout(() => { if (helpMsg) helpMsg.remove(); }, 15000);
          }
        }

        let btn = document.getElementById('music-btn');
        if (!btn) {
          btn = document.createElement('button');
          btn.id = 'music-btn';
          btn.textContent = 'üîä M√∫sica';
          btn.style.position = 'fixed';
          btn.style.bottom = '18px';
          btn.style.right = '18px';
          btn.style.zIndex = 99;
          btn.style.background = 'rgba(255,255,255,0.85)';
          btn.style.border = 'none';
          btn.style.borderRadius = '24px';
          btn.style.padding = '10px 18px';
          btn.style.fontSize = '1.1em';
          btn.style.cursor = 'pointer';
          document.body.appendChild(btn);
        }
        audio.volume = 0.7;
        audio.loop = true;
        // Intentar reproducir inmediatamente
        audio.play().then(() => {
          btn.textContent = 'üîä M√∫sica';
        }).catch(() => {
          // Si falla el autoplay, esperar click en el bot√≥n
          btn.textContent = '‚ñ∂Ô∏è M√∫sica';
        });
        btn.onclick = () => {
  const btnMusic = document.getElementById('btn-music');
  if (!btnMusic) return;

  if (!audio.paused) {
    // Si est√° sonando la m√∫sica de fondo ‚Üí cambiar al bot√≥n
    audio.pause();
    btnMusic.currentTime = 0;
    btnMusic.volume = 0.9;
    btnMusic.play();
    btn.textContent = 'üíñ Sonando';
  } else {
    // Volver a la m√∫sica de fondo
    btnMusic.pause();
    audio.play().catch(()=>{});
    btn.textContent = 'üîä M√∫sica';
  }
};
      }

      // Intentar reproducir la m√∫sica lo antes posible (al cargar la p√°gina)
      window.addEventListener('DOMContentLoaded', () => {
        playBackgroundMusic();
      });
    </script>
</body>
</html>
